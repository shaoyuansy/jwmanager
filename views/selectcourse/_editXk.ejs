
<div class="modal-dialog" style="margin-top: 10%">
    <div class="modal-content">
        <div class="modal-header" style="padding-bottom: 0">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            <h4 class="modal-title" id="myModalLabel">选课/修改</h4>
        </div>
        <div class="modal-body">
            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">选课</h3>
                    <div class="box-tools">
                        <ul class="pagination pagination-centered no-margin pull-right" >
                            <li><a href="#">选课</a></li>
                            <li><a href="#">修改</a></li>
                        </ul>
                    </div>
                </div>
                <div class="box-body no-padding">
                    <form id="myform">
                        <input id="KCID" name="KCID" type="hidden" value="<%= kcid %>">
                        <input id="JSID" name="JSID" type="hidden" value="<%= jsid %>">
                        <input id="SUR" name="SUR" type="hidden" value="<%= sur %>">
                        <table class="table">
                            <tr>
                                <th style="width: 20%">头数</th>
                                <th style="width: 30%">教师名</th>
                                <th style="width: 35%">备注</th>
                                <th style="width: 5%"></th>
                            </tr>
                            <tr>
                                <td><input id="XZTS" name="XZTS" type="number" min="1" max="<%= sur %>"
                                           class="form-control" value="<%= xzts %>">
                                </td>
                                <td><input id="JSMC" name="JSMC" type="text"
                                           class="form-control" value="<%= jsmc %>" ></td>
                                <td><input id="BZ" name="BZ" type="text" class="form-control" value="<%= bz %>" placeholder="代选老师请备注"></td>
                                <td><button id="btn" clicked="0" type="button" class="btn btn-primary" onclick="submitForm();submit()">选课</button></td>
                            </tr>
                        </table>
                    </form>
                </div>
                <!-- /.box-body -->
            </div>
        </div>
        <div class="modal-footer" >
            <button type="button" class="btn btn-default"  data-dismiss="modal">关闭</button>
        </div>
    </div><!-- /.modal-content -->
</div><!-- /.modal -->

<!-- 获取登录用户信息js-->
<script src="/javascripts/header.js"></script>
<!-- iCheck 1.0.1 -->
<script src="/AdminLTE/plugins/iCheck/icheck.min.js"></script>

<script>

    function submitForm(){
        if(document.getElementById("XZTS").value == ''||document.getElementById("XZTS").value == 0){
            alert("头数不能为空");
        }
        else if(parseInt(document.getElementById("XZTS").value) > parseInt(document.getElementById("SUR").value)){
            alert("超出剩余头数");
        }
        else{
            var btn = $("#btn");//按钮提交控制
            if(btn.attr("clicked") == "0"){
                //执行点击
                //提交操作先请求教师的id
                var XM = document.getElementById("JSMC").value;
                $.ajax({
                    type: "get",
                    url: '/teacherService/getTidByMc',
                    dataType: "json",
                    data:{xm:XM},
                    async: false,
                    cache: true,
                    success: function (jsmsg) {
                        var temp = jsmsg.aaData[0];
                        document.getElementById("JSID").value = temp['ID'];
                        submit();//再提交表单

                    },
                    error: function (e) {
                        console.log('教师id请求失败');
                    }
                });
                btn.attr("clicked","1");
            }else{
                //不再执行点击操作
            }
        }
    }
    function submit(){
        $.ajax({
            type: "post",
            url: '/selectcourse/_editXk.html',
            dataType: "json",
            data: $('#myform').serialize(),// 你的formid 注：后台req.body由控件name获取数据
            async: false,
            cache: true,
            success: function (msg) {
                if (msg.result != 0) {
                    $("#modal-edit-event").modal('hide');
                }
                location.reload();
            },
            error: function (e) {
                console.log(e);
            }
        });
    }
</script>